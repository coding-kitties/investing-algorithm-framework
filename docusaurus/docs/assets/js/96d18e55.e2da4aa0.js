"use strict";(self.webpackChunkinvesting_algorithm_framework_docs=self.webpackChunkinvesting_algorithm_framework_docs||[]).push([[1953],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),h=i,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return n?a.createElement(m,r(r({ref:t},c),{},{components:n})):a.createElement(m,r({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:i,r[1]=s;for(var u=2;u<o;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},7866:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var a=n(7462),i=(n(7294),n(3905));const o={id:"style-guide",title:"Style Guide",sidebar_label:"Style Guide"},r="Style Guide",s={unversionedId:"Contributing Guide/style-guide",id:"Contributing Guide/style-guide",title:"Style Guide",description:"Purpose of this document",source:"@site/docs/Contributing Guide/style_guide.md",sourceDirName:"Contributing Guide",slug:"/Contributing Guide/style-guide",permalink:"/investing-algorithm-framework/Contributing Guide/style-guide",draft:!1,tags:[],version:"current",frontMatter:{id:"style-guide",title:"Style Guide",sidebar_label:"Style Guide"},sidebar:"defaultSideBar",previous:{title:"Contributing",permalink:"/investing-algorithm-framework/Contributing Guide/contributing"},next:{title:"Logging Configuration",permalink:"/investing-algorithm-framework/Advanced Concepts/logging-configuration"}},l={},u=[{value:"Purpose of this document",id:"purpose-of-this-document",level:2},{value:"Code reviews",id:"code-reviews",level:2},{value:"Cheat sheets",id:"cheat-sheets",level:3},{value:"Author cheat sheet",id:"author-cheat-sheet",level:4},{value:"Reviewer cheat sheet",id:"reviewer-cheat-sheet",level:4},{value:"Tooling used",id:"tooling-used",level:2},{value:"Coding guidelines",id:"coding-guidelines",level:2},{value:"Framework project structure MUST",id:"framework-project-structure-must",level:3},{value:"Python Code Layout MUST",id:"python-code-layout-must",level:3},{value:"Python Naming convention MUST",id:"python-naming-convention-must",level:3},{value:"Python Comments / documentation MUST",id:"python-comments--documentation-must",level:3},{value:"Python Tuples, Lists, Dictionaries MUST",id:"python-tuples-lists-dictionaries-must",level:3},{value:"Python Use context managers MUST",id:"python-use-context-managers-must",level:3},{value:"Python Exceptions handling MUST",id:"python-exceptions-handling-must",level:3},{value:"Unit tests MUST",id:"unit-tests-must",level:3},{value:"Python unit tests",id:"python-unit-tests",level:4}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"style-guide"},"Style Guide"),(0,i.kt)("h2",{id:"purpose-of-this-document"},"Purpose of this document"),(0,i.kt)("p",null,"This document sets a baseline to ensure code quality during a project. It provides guidelines on Python coding best practices, but it can be adapted to any other programming language.\nYou will also find insights on responsibilities expected from a developer / data scientist before opening a Pull Request, and from a reviewer to ensure a good and constructive review."),(0,i.kt)("h2",{id:"code-reviews"},"Code reviews"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/inclusion-in-code-review/"},"Code reviews")," are an important part of open source projects. They help ensure the quality of our work and share it with others while proving code quality and sharing understanding."),(0,i.kt)("h3",{id:"cheat-sheets"},"Cheat sheets"),(0,i.kt)("p",null,"No matter what your previous experience in a topic is, ",(0,i.kt)("a",{parentName:"p",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/inclusion-in-code-review/#dealing-with-the-impostor-phenomenon"},"anyone can have valuable insights"),"!"),(0,i.kt)("p",null,"Here are below two cheat sheets to follow as a PR author and as PR reviewer."),(0,i.kt)("h4",{id:"author-cheat-sheet"},"Author cheat sheet"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/pull-requests/#size-guidance"},"Is the size acceptable?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/pull-requests/#pull-request-description"},"Is it well described?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/pull-request-template/pull-request-template/#pr-checklist"},"Is the check list complete?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/recipes/"},"Is the language specific guidance respected?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/author-guidance/#add-relevant-reviewers"},"Are relevant reviewers (if not enforced by policy) added?"))),(0,i.kt)("p",null,"Usually, a PR corresponds to a single task, i.e., a unit of added value to the codebase, e.g., a feature, a bugfix, documentation, etc. However, if the PR seems too large or complex, it might be an indicator that a task should be split into multiple pieces and have a PR for each of them."),(0,i.kt)("p",null,"When a review is conducted, ",(0,i.kt)("a",{parentName:"p",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/author-guidance/#be-open-to-receive-feedback"},"be open to feedback"),"."),(0,i.kt)("p",null,"You can find more detailed guidance as an author on the ",(0,i.kt)("a",{parentName:"p",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/author-guidance/"},"ISE Code With Engineering Playbook"),"."),(0,i.kt)("h4",{id:"reviewer-cheat-sheet"},"Reviewer cheat sheet"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/reviewer-guidance/#general-guidance"},"Understand the code you are reviewing and take your time")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/reviewer-guidance/#foster-a-positive-code-review-culture"},"Be inclusive, and foster a positive code review culture")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/reviewer-guidance/#code-quality-pass"},"Ensure code quality")),(0,i.kt)("li",{parentName:"ul"},"Ask for a walkthrough from the author if necessary (do not use walkthrough to hide a PR's complexity, but rather as a way to quickly onboard on it)")),(0,i.kt)("p",null,"You can find more detailed guidance as a reviewer on the ",(0,i.kt)("a",{parentName:"p",href:"https://microsoft.github.io/code-with-engineering-playbook/code-reviews/process-guidance/reviewer-guidance/"},"ISE Code With Engineering Playbook"),"."),(0,i.kt)("h2",{id:"tooling-used"},"Tooling used"),(0,i.kt)("p",null,"Code Quality can be enforced through tools (linters, formatters, type checkers, etc.) that automatically ensure consistency of the code. This topic should be discussed at the beginning of any project to decide which tools are best for your specific project."),(0,i.kt)("p",null,"Currently, the following tools are recommended:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Black: code formatter"),(0,i.kt)("li",{parentName:"ul"},"Flake8: linter")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: We have by default an pipeline that will run flake8 and markdownlint on your PR. You can also run these tools locally to ensure your code is compliant.")),(0,i.kt)("h2",{id:"coding-guidelines"},"Coding guidelines"),(0,i.kt)("p",null,"This coding agreement provides some guidelines for Python, but they can be adapted to any other programming language."),(0,i.kt)("p",null,"The guidelines in this section need to be followed by developers / data scientists. Reviewers will also need to validate these guidelines during PR review. The comments in brackets next to the section title refer to production-ready code. Experimental or exploratory code does not need to strictly follow these guidelines. However, it is recommended that most of the rules are followed, because then it will be much easier to convert experimental code into production-ready code when needed."),(0,i.kt)("h3",{id:"framework-project-structure-must"},"Framework project structure ","[MUST]"),(0,i.kt)("p",null,"The project structure should be organized in a way that is easy to understand and navigate. The structure should be consistent across all projects. Here is an example of a project structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"investing-algorithm-framework/\n\u2502\n\u251c\u2500\u2500 investing_algorithm_framework/\n\u2502   \u251c\u2500\u2500 my_module/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 my_module.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 my_other_module/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 my_other_module.py\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 __init__.py                # Entry point for the application\n\u2502\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 test_my_module.py\n\u2502   \u2514\u2500\u2500 test_my_other_module.py\n\u2502\n\u251c\u2500\u2500 docs/                      # Documentation (Sphinx, Markdown, etc.)\n\u251c\u2500\u2500 docusaurus/                # Docusaurus documentation\n\u251c\u2500\u2500 .gitignore                 # Ignore unnecessary files\n\u251c\u2500\u2500 README.md                  # Project documentation\n\u251c\u2500\u2500 pyproject.toml           # Build system and tool configurations\n\u2514\u2500\u2500 LICENSE                    # License file\n")),(0,i.kt)("h3",{id:"python-code-layout-must"},"Python Code Layout ","[MUST]"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"import"),": first standard libraries, then third party and finally local libraries. All groups alphabetically sorted."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"blank lines"),": two blank lines surrounding classes and top-level functions. Methods inside functions are surrounded by a single line."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"indentation"),": use 4 spaces (most IDEs will convert tab into 4 spaces by default)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"line length"),": maximum 88 chars.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"# Standard libs\nimport std_lib_1\nimport std_lib_2\n\n# Third party libs\nimport third_party_lib_1\nimport third_party_lib_2\n\n# Local lib\nfrom local_lib import class_1, function_1\n\n\n# After two blank lines\ndef top_level_function(args: int) -> str:\n    # Body\n")),(0,i.kt)("h3",{id:"python-naming-convention-must"},"Python Naming convention ","[MUST]"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"File names: lowercase, words separated by an underscore, e.g., ",(0,i.kt)("inlineCode",{parentName:"p"},"my_file.py"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"language, spelling"),":"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Class names, function names, and variable names are written in English. Use meaningful and grammatically correct names."),(0,i.kt)("li",{parentName:"ul"},"Use verbs to name functions and methods (they are actions), and names to name variables and classes (they are things)."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"class name"),": name should start with an uppercase and follow the camlCase convention if it has more than two words.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"function name"),":"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"lowercase, words separated by an underscore."),(0,i.kt)("li",{parentName:"ul"},"add ",(0,i.kt)("inlineCode",{parentName:"li"},"self")," argument at first position if the method is a class's method."),(0,i.kt)("li",{parentName:"ul"},"if the function's name clashes with a reserved word, append underscore."),(0,i.kt)("li",{parentName:"ul"},"use 2 underscores at the beginning for private class's methods."),(0,i.kt)("li",{parentName:"ul"},"use 1 underscore at the beginning of a private field."),(0,i.kt)("li",{parentName:"ul"},"specify the type of your input parameters"),(0,i.kt)("li",{parentName:"ul"},"always provide a return type (use 'None' if 'void')."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"variable name"),": lowercase, words separated by an underscore.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"constant name"),": uppercase, words separated by an underscore."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"my_variable = 10\n\nGLOBAL_CONSTANT = 10\n\nclass CatalogInformation:\n    def __init__(self, name: str) -> None:\n        # Body constructor\n\n    def get_metadata_count(self) -> int:\n        # Body method\n        return 1\n\n    def __check_internal_property(self) -> bool:\n        # Body private method\n        return True\n")),(0,i.kt)("h3",{id:"python-comments--documentation-must"},"Python Comments / documentation ","[MUST]"),(0,i.kt)("p",null,"Use comments, provide explanation on complex algorithms. Unless a function is trivial, always add a high-level comment."),(0,i.kt)("p",null,"Use docstrings to document your code. Docstrings are used to document the purpose of a function, the parameters it takes, and the return value. They are used to generate documentation automatically. ",(0,i.kt)("a",{parentName:"p",href:"https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html"},"Google-style docstrings")," are recommended."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'def is_valid(a: int, b: str) -> bool:\n    """\n    Explanation of the function\n\n    Args:\n        a (int): The first number.\n        b (int): The second number.\n\n    Returns:\n        Type: The return type.\n    """\n')),(0,i.kt)("h3",{id:"python-tuples-lists-dictionaries-must"},"Python Tuples, Lists, Dictionaries ","[MUST]"),(0,i.kt)("p",null,"Use tuples when data is non-changeable, dictionaries when you need to map things, and lists if your data can change later."),(0,i.kt)("p",null,"Functions can return multiple values, no need for a list:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'def get_info(self) -> str, int:\n    """\n    Return a string and an integer\n\n    Args:\n        name (str): a string\n        name (int): an integer\n    \n    Returns\n        Tuple[str, int]: a tuple containing a string and an integer\n    """\n    return "hello world", 30\n')),(0,i.kt)("h3",{id:"python-use-context-managers-must"},"Python Use context managers ","[MUST]"),(0,i.kt)("p",null,"Context managers are tool to use in situations where you need to run some code that has preconditions and postconditions."),(0,i.kt)("p",null,"For instance, when you read the content of a file, you need to ensure that you close the handle regardless of the success or the failure of the operation. With the ",(0,i.kt)("inlineCode",{parentName:"p"},"with")," keyword you can achieve this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"with open(filename) as fd:\n    process_file(fd)\n\n# Note that parentheses are supported in Python 3.10 for context manager,\n# useful when you have many 'with'\nwith (\n    CtxManager1() as example1,\n    CtxManager2() as example2,\n    CtxManager3() as example3,\n):\n    ...\n")),(0,i.kt)("p",null,"You can implement your own context manager should you need to execute actions in a certain order. Consider the case where you want to update a service configuration. You need first to stop the service, update the configuration then start the service again:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'class ServiceHandler:\n    def __enter__(self) -> ServiceHandler:\n        run("systemctl stop my.service")\n        return self\n\n    def __exit__(self, exc_type: str, ex_value: str, ex_traceback: str) -> None:\n        run("systemctl start my.service")\n\ndef update_service_conf() -> None:\n    # Body to update service\'s configuration\n\nif __name__ == \'__main__\':\n    with ServiceHandler():\n        update_service_conf()\n')),(0,i.kt)("h3",{id:"python-exceptions-handling-must"},"Python Exceptions handling ","[MUST]"),(0,i.kt)("p",null,"Hiding an exception or not properly anticipating potential errors (accessing an API for instance, network issues ",(0,i.kt)("em",{parentName:"p"},"can")," arise) can lead to unexpected behaviors or terminating the execution. Another example is that the caller should be notified if a function receives wrong input parameters to avoid this way wrong results that might be difficult to debug."),(0,i.kt)("p",null,"Each function has a logic, this logic must be followed by exceptions raised. For instance, if you have a function that get some data from an API, exceptions raised by this function should be logical: connection error, timeout etc. The exception must be raised at the right level of abstraction."),(0,i.kt)("p",null,"If you choose to propagate the exception to the caller, ensure that you do not expose sensitive information. Tracebacks of exceptions can contain sensitive details leading to exposing intellectual property."),(0,i.kt)("p",null,"Do not use exceptions as a ",(0,i.kt)("inlineCode",{parentName:"p"},"go-to")," logic, meaning catching an exception and from the ",(0,i.kt)("inlineCode",{parentName:"p"},"except")," calling other business code - the flow of the program will become harder to read. Exceptions are ",(0,i.kt)("em",{parentName:"p"},"usually")," to notify the caller that something unexpected occured."),(0,i.kt)("p",null,"Finally, ",(0,i.kt)("a",{parentName:"p",href:"https://microsoft.github.io/code-with-engineering-playbook/observability/"},"observability")," is an important engineering fundamental. Properly handling exceptions and managing observability (with AppInsight for instance) will lead to a more robust application and easier debugging when something unexpected occurs."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# Never do ...\ntry:\n    process_data()\nexcept:\n    pass\n\n# Encapsulate orginal exception trace\ndef process_data() -> None:\n    try:\n        do_something()\n    except KeyError as e:\n        # Raise a specific exception from do_something,\n        # encapsulate trace to a custom exception\n        raise MyApplicationException("Item not present") from e\n')),(0,i.kt)("h3",{id:"unit-tests-must"},"Unit tests ","[MUST]"),(0,i.kt)("p",null,"Unit testing is a core tool in software engineering. They help us verify the correctness of our code, encourage good design practices, and reduce chances to have bugs hitting production. Unit tests can improve development efficiency."),(0,i.kt)("p",null,"Unit tests should be:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Reliable: should be 100% reliable so failures indicate a bug in the code."),(0,i.kt)("li",{parentName:"ul"},"Fast: should run in milliseconds."),(0,i.kt)("li",{parentName:"ul"},"Isolated: removing all external dependencies ensures reliability and speed.")),(0,i.kt)("h4",{id:"python-unit-tests"},"Python unit tests"),(0,i.kt)("p",null,"For Python, we recommend using ",(0,i.kt)("inlineCode",{parentName:"p"},"unittest"),". ",(0,i.kt)("inlineCode",{parentName:"p"},"unittest")," is a powerful tool that makes it easy to write simple tests, but also scales to support complex functional testing for applications and libraries."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"from unittest import TestCase\n\n\nclass TestMyClass(TestCase):\n\n    def setup(self):\n        # Setup\n\n    @classmethod\n    def setup_class(cls):\n        # Setup class\n        pass\n\n    def test_my_function(self):\n        # Test the function\n        self.assertEqual(my_function(1), 2)\n")),(0,i.kt)("p",null,"Please refer to ",(0,i.kt)("a",{parentName:"p",href:"https://docs.python.org/3/library/unittest.html"},"unittest site")," for more useful patterns."))}d.isMDXComponent=!0}}]);